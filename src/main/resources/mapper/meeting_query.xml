<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.ssafy.enjoyTrip.meeting.dao.MeetingDao">
<insert id="meetingInsert" parameterType="com.ssafy.enjoyTrip.meeting.dto.MeetingDto"> 
	 insert into meeting (user_id, user_name, title, content, meeting_password, attraction_id, meeting_start_date, meeting_end_date, thumbnail_url, reg_date )
	 values (#{userId}, #{userName}, #{title}, #{content}, #{meetingPassword}, #{attractionId}, #{meetingStartDate}, #{meetingEndDate}, #{thumbnailUrl}, #{regDate})
</insert>

<select id="meetingDetail" parameterType="int" resultType="com.ssafy.enjoyTrip.meeting.dto.MeetingDto">
	select m.*, a.attraction_id , a.addr1, a.first_image, a.first_image2, a.latitude, a.longitude, u.name, u.user_profile_image_url, m.reg_Date
	from meeting m join attraction_info a
				   join user u
	where a.attraction_id = m.attraction_id
	  and meeting_id =#{meetingId} and m.user_id = u.user_id;
</select>

<select id="meetingList" resultType="com.ssafy.enjoyTrip.meeting.dto.MeetingDto">
	select m.*, a.attraction_id , a.addr1, a.first_image, a.first_image2, u.name as userName, u.user_profile_image_url , m.reg_date, m.thumbnail_url
	FROM meeting m
			 JOIN attraction_info a ON a.attraction_id = m.attraction_id
			 JOIN user u ON m.user_id = u.user_id
	WHERE m.title LIKE concat('%', #{searchTitle},'%')
	  AND a.addr1 LIKE concat('%',#{searchAddr},'%')
	  AND m.meeting_start_date LIKE concat('%',#{meetingStartDate},'%')
	  AND m.meeting_end_Date LIKE concat('%',#{meetingEndDate},'%')
	ORDER BY m.reg_Date DESC
		LIMIT #{limit} OFFSET #{offset}
</select>

<update id="meetingUpdate" parameterType="com.ssafy.enjoyTrip.meeting.dto.MeetingDto">
	update meeting set title=#{title}, content=#{content}, meeting_password=#{meetingPassword},
	                   meeting_start_date=#{meetingStartDate}, meeting_end_date=#{meetingEndDate},
	                   attraction_id=#{attractionId}, thumbnail_url = #{thumbnailUrl}
	where meeting_id = #{meetingId};

</update>

<delete id="meetingDelete" parameterType="int">
	delete from meeting where meeting_id = #{meetingId}
</delete>

<select id="myMeetingList" parameterType="com.ssafy.enjoyTrip.meeting.dto.MeetingDto">
	select m.*, a.attraction_id , a.addr1, a.first_image, a.first_image2, a.latitude, a.longitude, u.name, u.user_profile_image_url, m.reg_date, m.thumbnail_url
	from meeting m join attraction_info a
				   join user u where a.attraction_id = m.attraction_id
								 and m.user_id = #{userId} and m.user_id = u.user_id;

</select>
</mapper>
